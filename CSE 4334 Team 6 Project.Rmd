---
title: "CSE 4334 Team 6 Project"
output: html_document
author: "Azmi Alinufael, Maheer Jawwad, Sujana Kabir"
date: "2025-11-07"
---

Preparing Data

```{r}
# Load necessary libraries
# additional libraries can be added as needed

library(ggplot2)
library(caret)
library(dplyr)
library(corrplot)


```

```{r}
#Loading and Reading Dataset

insure <- read.csv("insurance.csv")

# Exploring the structure of the dataset
summary(insure)

# Checking for missing values
# looks clean, no missing values so far
sum(is.na(insure))

```

## Initial EDA

```{r}
# Wanted to see which numeric variables are correlated.
# selecting only numeric columns first 
numeric_insure <- insure %>% select_if(is.numeric)
cor_matrix <- cor(numeric_insure)

# Plotting the heatmap
corrplot(cor_matrix, method = "color", addCoef.col = "black", type="upper", diag=FALSE)

```

It looks like age and bmi have some positive correlation with charges, but it's not super strong. We probably need to look at the categorical variables too.

```{r}
# Checking the distribution of our target variable, charges
ggplot(insure, aes(x = charges)) +
  geom_histogram(bins = 30, fill = "grey", color = "white") +
  labs(title = "Distribution of Insurance Charges") +
  theme_minimal()

```

The charges are heavily skewed to the right. Most people have lower charges, but there's a long tail of expensive claims. May have to fix this later (maybe log transformation) to make the regression work better.

# Baseline Linear Regression

haven't split the data into train/test yet.

```{r}
# Naive model
baseline_model <- lm(charges ~ ., data = insure)

summary(baseline_model)

```

R-squared around 0.75 means 75% of the insurance charge variance can be explained by this model. Also to note, all else being equal, being a smoker is associated with paying roughly \$24,421 more in charges than a non-smoker.

# K-Means Clustering

```{r}
# data prep for clustering
cluster_data <- insure %>%
  select(age, bmi, children)
scaled_cluster_data <- scale(cluster_data)
```

Determining optimal number of clusters (K):

```{r}
wss <- numeric(10)
for (i in 1:10) {
  wss[i] <- sum(kmeans(scaled_cluster_data, centers = i)$withinss)
}
plot(1:10, wss, type = "b", xlab = "Number of Clusters (K)",
     ylab = "Within-Cluster Sum of Squares (WSS)",
     main = "Elbow Method for K-Means Clustering")
```
Running K-means clustering:

```{r}
# Run K-Means 
set.seed(42) 
kmeans_model <- kmeans(scaled_cluster_data, centers = 4, nstart = 25)

# cluster assignment to the data
insure$cluster <- as.factor(kmeans_model$cluster)

# analyze clusters 
insure %>%
  group_by(cluster) %>%
  summarise(
    N = n(),
    Avg_Age = mean(age),
    Avg_BMI = mean(bmi),
    Avg_Children = mean(children),
    Avg_Charges = mean(charges)
  )
```

K-Means model segmented customers into four groups based on age, BMI, and children. Cluster 3 is the highest-risk segment, characterized by high BMI and the highest average charges ($17,652). In contrast, Cluster 1 represents the youngest, lowest-charge segment ($8,556). The other two clusters, Cluster 4 (oldest individuals) and Cluster 2 (highest number of children), represent intermediate risk profiles.